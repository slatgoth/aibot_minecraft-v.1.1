# Minecraft LLM Bot (Mineflayer + Ollama)

Бот-персонаж для Minecraft на базе Mineflayer и LLM (Ollama). Сканирует окружение, хранит память о мире и игроках, принимает решения через LLM и выполняет действия через набор навыков. Поддерживает ручной, автономный и режим выживания, а также обучение через правила и фидбек.

Статус: ранняя версия. Бот может ошибаться, но уже умеет вести диалоги, помнить факты и выполнять задачи.

## Возможности
- Режимы: manual / autonomous / survival.
- LLM отвечает строго в JSON и управляет действиями.
- Память о фактах и общении с игроками.
- Навыки добычи, крафта, следования, взаимодействия с блоками.
- Автоматические реакции на угрозы и низкое здоровье.
- Чтение табличек и учет построек игроков.
- Обучение: правила "делай/нельзя", фидбек и маршрут моделей.

## Требования
- Windows 10/11 для EXE (для dev запуска можно и другую ОС).
- Node.js 20+ (локальный запуск и сборка).
- Java 17+ (нужно для ViaProxy).
- Ollama (LLM сервер).
- Minecraft сервер (онлайн или оффлайн).

## Быстрый старт (EXE)
1. Установи Java (JRE/JDK) 17+.
2. Установи Ollama:
   - Запусти сервер: `ollama serve`
   - Скачай модель: `ollama pull [name of model]`
   - Важно: крупные модели требуют больше RAM. Если не хватает памяти, бот переключится на fallback модель.
3. Скачай EXE из Releases:
   - https://github.com/slatgoth/aibot_minecraft/releases
4. Запусти EXE.
5. В панели заполни ViaProxy:
   - `MC_SERVER_HOST/MC_SERVER_PORT` - адрес сервера (например, `example:25565`).
   - `auth-method`: NONE для оффлайн сервера, ACCOUNT для онлайн.
   - `target-version`: версия сервера или Auto Detect.
6. В панели подключения бота:
   - `BOT_HOST = 127.0.0.1`
   - `BOT_PORT = 25568`
   - `BOT_VERSION = 1.21.4`
   - `BOT_USERNAME = любой ник`
7. Нажми "Запустить ViaProxy", затем "Запустить бота".

Если сервер уже совпадает с версией бота, ViaProxy не нужен - подключайся напрямую, указав адрес сервера в `BOT_HOST/BOT_PORT`.

## Локальный запуск (из исходников)
```bash
npm install
npm start
```

## Сборка EXE
```bash
npm install
npm run dist:exe
```
Готовый exe появляется в `dist/`.

## Настройка LLM
Конфиг хранится в `%APPDATA%\\minecraft-llm-bot\\config.user.json`.
Основные поля:
- `llm.host` - адрес Ollama (обычно `http://127.0.0.1:11434`).
- `llm.defaultModel` - модель по умолчанию.
- `llm.fallbackModel` - запасная модель при нехватке памяти.

Маршрутизация модели на вкладке "Обучение":
```json
{
  "default": "gpt-oss:20b",
  "fallback": "llama3.1:8b",
  "direct": "llama3.1:8b",
  "autonomous": "mixtral"
}
```

## Обучение и фидбек
Во вкладке "Обучение":
- Правила "делай/нельзя" добавляются в системный промт.
- Фидбек увеличивает или снижает приоритет правил.
- Поддерживается быстрый фидбек из чата.

Примеры фидбека:
- `бот, +2 отвечай всем`
- `бот, -2 не спамь`
- `бот, поощрение +3 делай: подбирай дроп`

## Команды (примеры)
- `bot, статус`
- `bot, ко мне`
- `bot, добудь дерево 10`
- `bot, скрафть кирку`
- `bot, прыгай 3`
- `bot, прочитай табличку`
- `bot, собери дрова 64`
- `bot, займись фермой`

## Что означает каждый IP/порт
- `BOT_HOST/BOT_PORT` - куда подключается бот (обычно локальный ViaProxy).
- `MC_SERVER_HOST/MC_SERVER_PORT` - настоящий адрес сервера, для справки и синхронизации `viaproxy.yml`.
- `bind-address` в `viaproxy.yml` - адрес/порт ViaProxy.
- `target-address` в `viaproxy.yml` - реальный адрес сервера.
- `OLLAMA_HOST` - адрес Ollama (`http://127.0.0.1:11434`).

## Панель управления (EXE)
- Запуск/останов ViaProxy и бота.
- Живое управление: чат, режимы, остановка задач, перезагрузка prompt.
- Смена ника (с перезапуском бота).
- Автоподключение при разрыве.
- Синхронизация `viaproxy.yml` из панели.
- Логи бота и ViaProxy прямо в панели.
- Вкладки "Память" и "Обучение".

Настройки и prompt сохраняются сюда:
- `%APPDATA%\\minecraft-llm-bot\\config.user.json`
- `%APPDATA%\\minecraft-llm-bot\\system_prompt.txt`
- `%APPDATA%\\minecraft-llm-bot\\training.json`

## Обзор и архитектура
- `src/index.js`: запуск бота, подключение плагинов.
- `src/llm_client.js`: клиент Ollama, JSON-ответы, выбор модели.
- `src/perception.js`: снимок мира.
- `src/planner.js`: режимы поведения, контекст, вызовы LLM.
- `src/skills.js`: набор инструментов.
- `src/task_manager.js`: длинные задачи.
- `src/chat.js`: обработка команд и фидбека.
- `src/memory_store.js`: долговременная память.
- `src/reflexes.js`: быстрые реакции.
- `src/observer.js`: реакции на события и бантер.

## Последнее обновление (v1.2.8)
- Вкладка "Обучение" с правилами и фидбеком.
- Система приоритетов правил на основе фидбека.
- Авто-fallback модели при нехватке памяти.
- Маршрутизация моделей по причинам запросов.

## Лицензия
MIT License. См. `LICENSE`.

## Поддержать проект
- Boosty: https://boosty.to/slatgoth
